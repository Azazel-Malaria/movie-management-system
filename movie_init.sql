-- 创建数据库
CREATE DATABASE IF NOT EXISTS movie_db;
USE movie_db;

-- 创建出品公司表
CREATE TABLE production_company (
    company_id INT AUTO_INCREMENT PRIMARY KEY,
    company_name VARCHAR(50) NOT NULL,
    city VARCHAR(20)
);

-- 创建演员表
CREATE TABLE actor_info (
    actor_id INT AUTO_INCREMENT PRIMARY KEY,
    actor_name VARCHAR(50) NOT NULL,
    gender VARCHAR(2) NOT NULL,
    country VARCHAR(20)
);

-- 创建导演表
CREATE TABLE director_info (
    director_id INT AUTO_INCREMENT PRIMARY KEY,
    director_name VARCHAR(50) NOT NULL,
    gender VARCHAR(2) NOT NULL,
    country VARCHAR(20)
);

-- 创建电影表
CREATE TABLE movie_info (
    movie_id INT AUTO_INCREMENT PRIMARY KEY,
    movie_name VARCHAR(50) NOT NULL,
    release_date DATE,
    country VARCHAR(20),
    type VARCHAR(20),
    year INT,
    company_id INT,
    FOREIGN KEY (company_id) REFERENCES production_company(company_id)
);

-- 创建角色表
CREATE TABLE role_info (
    role_id INT AUTO_INCREMENT PRIMARY KEY,
    movie_id INT NOT NULL,
    actor_id INT NOT NULL,
    role_name VARCHAR(50) NOT NULL,
    FOREIGN KEY (movie_id) REFERENCES movie_info(movie_id),
    FOREIGN KEY (actor_id) REFERENCES actor_info(actor_id),
    UNIQUE KEY uq_movie_actor (movie_id, actor_id)
);

-- 创建演员-电影关系表
CREATE TABLE actor_movie_relation (
    actor_id INT NOT NULL,
    movie_id INT NOT NULL,
    PRIMARY KEY (actor_id, movie_id),
    FOREIGN KEY (actor_id) REFERENCES actor_info(actor_id),
    FOREIGN KEY (movie_id) REFERENCES movie_info(movie_id)
);

-- 创建导演-电影关系表
CREATE TABLE director_movie_relation (
    director_id INT NOT NULL,
    movie_id INT NOT NULL,
    PRIMARY KEY (director_id, movie_id),
    FOREIGN KEY (director_id) REFERENCES director_info(director_id),
    FOREIGN KEY (movie_id) REFERENCES movie_info(movie_id)
);

-- 插入20家出品公司
INSERT INTO production_company (company_name, city) VALUES
('华纳兄弟影业', '洛杉矶'),
('迪士尼影业', '伯班克'),
('环球影业', '环球城'),
('派拉蒙影业', '洛杉矶'),
('索尼影业', '卡尔弗城'),
('20世纪福克斯', '洛杉矶'),
('米高梅电影公司', '比佛利山庄'),
('狮门影业', '圣莫尼卡'),
('传奇影业', '伯班克'),
('梦工厂', '环球城'),
('焦点影业', '环球城'),
('新线影业', '伯班克'),
('哥伦比亚影业', '卡尔弗城'),
('华谊兄弟', '北京'),
('博纳影业', '北京'),
('光线影业', '北京'),
('万达影业', '北京'),
('阿里影业', '杭州'),
('腾讯影业', '深圳'),
('Netflix', '洛斯加托斯');

-- 插入50位演员
INSERT INTO actor_info (actor_name, gender, country) VALUES
('汤姆·汉克斯', '男', '美国'),
('莱昂纳多·迪卡普里奥', '男', '美国'),
('斯嘉丽·约翰逊', '女', '美国'),
('布拉德·皮特', '男', '美国'),
('安吉丽娜·朱莉', '女', '美国'),
('约翰尼·德普', '男', '美国'),
('摩根·弗里曼', '男', '美国'),
('艾玛·沃特森', '女', '英国'),
('丹尼尔·雷德克里夫', '男', '英国'),
('鲁伯特·格林特', '男', '英国'),
('克里斯·埃文斯', '男', '美国'),
('小罗伯特·唐尼', '男', '美国'),
('克里斯·海姆斯沃斯', '男', '澳大利亚'),
('马克·鲁法洛', '男', '美国'),
('斯嘉丽·约翰逊', '女', '美国'),
('盖尔·加朵', '女', '以色列'),
('杰森·莫玛', '男', '美国'),
('亨利·卡维尔', '男', '英国'),
('本·阿弗莱克', '男', '美国'),
('马特·达蒙', '男', '美国'),
('吴京', '男', '中国'),
('沈腾', '男', '中国'),
('黄渤', '男', '中国'),
('徐峥', '男', '中国'),
('王宝强', '男', '中国'),
('邓超', '男', '中国'),
('刘德华', '男', '中国'),
('周润发', '男', '中国'),
('梁朝伟', '男', '中国'),
('章子怡', '女', '中国'),
('巩俐', '女', '中国'),
('周冬雨', '女', '中国'),
('张译', '男', '中国'),
('张涵予', '男', '中国'),
('古天乐', '男', '中国'),
('汤唯', '女', '中国'),
('舒淇', '女', '中国'),
('范冰冰', '女', '中国'),
('李冰冰', '女', '中国'),
('彭于晏', '男', '中国'),
('胡歌', '男', '中国'),
('王凯', '男', '中国'),
('靳东', '男', '中国'),
('雷佳音', '男', '中国'),
('郭京飞', '男', '中国'),
('张若昀', '男', '中国'),
('朱一龙', '男', '中国'),
('易烊千玺', '男', '中国'),
('王俊凯', '男', '中国'),
('王源', '男', '中国');

-- 插入20位导演
INSERT INTO director_info (director_name, gender, country) VALUES
('史蒂文·斯皮尔伯格', '男', '美国'),
('克里斯托弗·诺兰', '男', '英国'),
('詹姆斯·卡梅隆', '男', '加拿大'),
('昆汀·塔伦蒂诺', '男', '美国'),
('彼得·杰克逊', '男', '新西兰'),
('大卫·芬奇', '男', '美国'),
('马丁·斯科塞斯', '男', '美国'),
('雷德利·斯科特', '男', '英国'),
('蒂姆·波顿', '男', '美国'),
('张艺谋', '男', '中国'),
('冯小刚', '男', '中国'),
('陈凯歌', '男', '中国'),
('姜文', '男', '中国'),
('王家卫', '男', '中国'),
('徐克', '男', '中国'),
('周星驰', '男', '中国'),
('宁浩', '男', '中国'),
('贾樟柯', '男', '中国'),
('管虎', '男', '中国'),
('文牧野', '男', '中国');

-- 插入100部电影
INSERT INTO movie_info (movie_name, release_date, country, type, year, company_id) VALUES
('肖申克的救赎', '1994-09-23', '美国', '剧情', 1994, 1),
('阿甘正传', '1994-07-06', '美国', '剧情', 1994, 1),
('泰坦尼克号', '1997-12-19', '美国', '爱情', 1997, 3),
('盗梦空间', '2010-07-16', '美国', '科幻', 2010, 4),
('星际穿越', '2014-11-07', '美国', '科幻', 2014, 2),
('复仇者联盟4：终局之战', '2019-04-26', '美国', '动作', 2019, 5),
('阿凡达', '2009-12-18', '美国', '科幻', 2009, 3),
('指环王：王者归来', '2003-12-17', '新西兰', '奇幻', 2003, 6),
('蝙蝠侠：黑暗骑士', '2008-07-18', '美国', '动作', 2008, 4),
('哈利·波特与魔法石', '2001-11-16', '英国', '奇幻', 2001, 7),
('战狼2', '2017-07-27', '中国', '动作', 2017, 14),
('流浪地球', '2019-02-05', '中国', '科幻', 2019, 15),
('哪吒之魔童降世', '2019-07-26', '中国', '动画', 2019, 16),
('红海行动', '2018-02-16', '中国', '动作', 2018, 15),
('唐人街探案3', '2021-02-12', '中国', '喜剧', 2021, 17),
('你好，李焕英', '2021-02-12', '中国', '喜剧', 2021, 18),
('长津湖', '2021-09-30', '中国', '战争', 2021, 19),
('我和我的祖国', '2019-09-30', '中国', '剧情', 2019, 20),
('我不是药神', '2018-07-05', '中国', '剧情', 2018, 16),
('西虹市首富', '2018-07-27', '中国', '喜剧', 2018, 16),
('复仇者联盟', '2012-05-04', '美国', '动作', 2012, 5),
('复仇者联盟2：奥创纪元', '2015-05-01', '美国', '动作', 2015, 5),
('复仇者联盟3：无限战争', '2018-04-27', '美国', '动作', 2018, 5),
('钢铁侠', '2008-05-02', '美国', '科幻', 2008, 5),
('美国队长', '2011-07-22', '美国', '科幻', 2011, 5),
('雷神', '2011-05-06', '美国', '奇幻', 2011, 5),
('蜘蛛侠：英雄归来', '2017-07-07', '美国', '动作', 2017, 5),
('黑豹', '2018-02-16', '美国', '科幻', 2018, 5),
('神奇女侠', '2017-06-02', '美国', '动作', 2017, 1),
('海王', '2018-12-07', '美国', '科幻', 2018, 1),
('速度与激情7', '2015-04-03', '美国', '动作', 2015, 3),
('速度与激情8', '2017-04-14', '美国', '动作', 2017, 3),
('侏罗纪世界', '2015-06-12', '美国', '科幻', 2015, 3),
('侏罗纪世界2', '2018-06-22', '美国', '科幻', 2018, 3),
('变形金刚4', '2014-06-27', '美国', '科幻', 2014, 4),
('变形金刚5', '2017-06-23', '美国', '科幻', 2017, 4),
('狮子王', '2019-07-19', '美国', '动画', 2019, 2),
('冰雪奇缘2', '2019-11-22', '美国', '动画', 2019, 2),
('寻梦环游记', '2017-11-24', '美国', '动画', 2017, 2),
('疯狂动物城', '2016-03-04', '美国', '动画', 2016, 2),
('头号玩家', '2018-03-30', '美国', '科幻', 2018, 1),
('敦刻尔克', '2017-09-01', '英国', '战争', 2017, 4),
('星际迷航', '2009-05-08', '美国', '科幻', 2009, 4),
('星际迷航2：暗黑无界', '2013-05-16', '美国', '科幻', 2013, 4),
('星际迷航3：超越星辰', '2016-07-22', '美国', '科幻', 2016, 4),
('加勒比海盗5', '2017-05-26', '美国', '冒险', 2017, 2),
('加勒比海盗4', '2011-05-20', '美国', '冒险', 2011, 2),
('金刚：骷髅岛', '2017-03-24', '美国', '冒险', 2017, 1),
('哥斯拉', '2014-05-16', '美国', '科幻', 2014, 1),
('哥斯拉2：怪兽之王', '2019-05-31', '美国', '科幻', 2019, 1),
('环太平洋', '2013-07-31', '美国', '科幻', 2013, 1),
('环太平洋：雷霆再起', '2018-03-23', '美国', '科幻', 2018, 1),
('猩球崛起3：终极之战', '2017-09-15', '美国', '科幻', 2017, 6),
('猩球崛起2：黎明之战', '2014-08-29', '美国', '科幻', 2014, 6),
('火星救援', '2015-11-25', '美国', '科幻', 2015, 3),
('地心引力', '2013-10-04', '美国', '科幻', 2013, 1),
('降临', '2017-01-20', '美国', '科幻', 2017, 4),
('银翼杀手2049', '2017-10-06', '美国', '科幻', 2017, 1),
('神奇动物在哪里', '2016-11-25', '英国', '奇幻', 2016, 7),
('神奇动物：格林德沃之罪', '2018-11-16', '英国', '奇幻', 2018, 7),
('哈利·波特与死亡圣器(下)', '2011-07-15', '英国', '奇幻', 2011, 7),
('哈利·波特与死亡圣器(上)', '2010-11-19', '英国', '奇幻', 2010, 7),
('哈利·波特与混血王子', '2009-07-15', '英国', '奇幻', 2009, 7),
('哈利·波特与凤凰社', '2007-07-11', '英国', '奇幻', 2007, 7),
('哈利·波特与火焰杯', '2005-11-18', '英国', '奇幻', 2005, 7),
('哈利·波特与阿兹卡班的囚徒', '2004-06-04', '英国', '奇幻', 2004, 7),
('哈利·波特与密室', '2002-11-15', '英国', '奇幻', 2002, 7),
('星球大战：原力觉醒', '2016-01-09', '美国', '科幻', 2016, 2),
('星球大战：最后的绝地武士', '2018-01-05', '美国', '科幻', 2018, 2),
('星球大战：天行者崛起', '2019-12-20', '美国', '科幻', 2019, 2),
('碟中谍6：全面瓦解', '2018-08-31', '美国', '动作', 2018, 4),
('碟中谍5：神秘国度', '2015-09-08', '美国', '动作', 2015, 4),
('007：幽灵党', '2015-11-13', '英国', '动作', 2015, 6),
('007：无暇赴死', '2021-10-08', '英国', '动作', 2021, 6),
('谍影重重5', '2016-08-23', '美国', '动作', 2016, 3),
('谍影重重4', '2012-10-25', '美国', '动作', 2012, 3),
('极限特工：终极回归', '2017-02-10', '美国', '动作', 2017, 4),
('极限特工3', '2017-01-20', '美国', '动作', 2017, 4),
('王牌特工：特工学院', '2015-03-27', '英国', '动作', 2015, 6),
('王牌特工2：黄金圈', '2017-10-20', '英国', '动作', 2017, 6),
('疾速追杀', '2014-10-24', '美国', '动作', 2014, 1),
('疾速特攻', '2017-02-10', '美国', '动作', 2017, 1),
('疾速备战', '2019-05-17', '美国', '动作', 2019, 1),
('敢死队3', '2014-09-01', '美国', '动作', 2014, 3),
('敢死队2', '2012-09-04', '美国', '动作', 2012, 3),
('敢死队', '2010-08-20', '美国', '动作', 2010, 3),
('终结者：创世纪', '2015-07-01', '美国', '科幻', 2015, 4),
('终结者：黑暗命运', '2019-11-01', '美国', '科幻', 2019, 4),
('终结者5', '2015-07-01', '美国', '科幻', 2015, 4),
('终结者4', '2009-06-09', '美国', '科幻', 2009, 4),
('终结者3', '2003-07-02', '美国', '科幻', 2003, 4),
('终结者2', '1991-07-03', '美国', '科幻', 1991, 4),
('终结者', '1984-10-26', '美国', '科幻', 1984, 4),
('异形：契约', '2017-06-16', '美国', '科幻', 2017, 3),
('普罗米修斯', '2012-09-02', '美国', '科幻', 2012, 3),
('异形4', '1997-11-26', '美国', '科幻', 1997, 3),
('异形3', '1992-05-22', '美国', '科幻', 1992, 3),
('异形2', '1986-07-18', '美国', '科幻', 1986, 3),
('异形', '1979-05-25', '美国', '科幻', 1979, 3);

-- 为每部电影随机分配导演
INSERT INTO director_movie_relation (director_id, movie_id)
SELECT 
    FLOOR(1 + RAND() * 20) AS director_id,
    movie_id
FROM movie_info;

-- 为每部电影分配1-3位导演
INSERT INTO director_movie_relation (director_id, movie_id)
SELECT 
    FLOOR(1 + RAND() * 20) AS director_id,
    movie_id
FROM movie_info
WHERE movie_id % 3 = 0
ON DUPLICATE KEY UPDATE director_id = director_id;

INSERT INTO director_movie_relation (director_id, movie_id)
SELECT 
    FLOOR(1 + RAND() * 20) AS director_id,
    movie_id
FROM movie_info
WHERE movie_id % 4 = 0
ON DUPLICATE KEY UPDATE director_id = director_id;

-- 为每部电影分配5-10位演员
INSERT INTO actor_movie_relation (actor_id, movie_id)
SELECT 
    actor_id,
    movie_id
FROM (
    SELECT 
        movie_id,
        FLOOR(1 + RAND() * 50) AS actor_id
    FROM movie_info
    CROSS JOIN (SELECT 1 AS n UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) nums
) AS temp
GROUP BY movie_id, actor_id
HAVING COUNT(*) = 1;

-- 添加更多演员
INSERT INTO actor_movie_relation (actor_id, movie_id)
SELECT 
    actor_id,
    movie_id
FROM (
    SELECT 
        movie_id,
        FLOOR(1 + RAND() * 50) AS actor_id
    FROM movie_info
    WHERE movie_id % 2 = 0
    CROSS JOIN (SELECT 1 AS n UNION SELECT 2 UNION SELECT 3) nums
) AS temp
ON DUPLICATE KEY UPDATE actor_id = actor_id;

-- 为每部电影创建角色
INSERT INTO role_info (movie_id, actor_id, role_name)
SELECT 
    amr.movie_id,
    amr.actor_id,
    CONCAT('角色', FLOOR(1 + RAND() * 1000))
FROM actor_movie_relation amr;